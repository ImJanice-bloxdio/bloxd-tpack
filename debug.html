<!DOCTYPE html>
<html>
<head>
    <title>æ–‡ä»¶ä¸‹è½½è¯Šæ–­</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        .success { color: green; }
        .error { color: red; }
        .test-result { margin: 10px 0; padding: 10px; border-left: 4px solid #ccc; }
    </style>
</head>
<body>
    <h1>ğŸ”§ æ–‡ä»¶ä¸‹è½½è¯Šæ–­å·¥å…·</h1>
    <div id="results"></div>
    
    <script>
        async function diagnoseDownload() {
            const results = document.getElementById('results');
            const testFiles = [
                'downloads/skyboxes.zip',
                'downloads/Some Combination.zip'
            ];
            
            for (const fileUrl of testFiles) {
                const resultDiv = document.createElement('div');
                resultDiv.className = 'test-result';
                resultDiv.innerHTML = `<h3>æµ‹è¯•æ–‡ä»¶: ${fileUrl}</h3>`;
                results.appendChild(resultDiv);
                
                try {
                    // æµ‹è¯•1: æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
                    resultDiv.innerHTML += `<p>1. æ£€æŸ¥æ–‡ä»¶å¯è®¿é—®æ€§...</p>`;
                    const headResponse = await fetch(fileUrl, { method: 'HEAD' });
                    
                    if (!headResponse.ok) {
                        throw new Error(`HTTP ${headResponse.status}: ${headResponse.statusText}`);
                    }
                    
                    resultDiv.innerHTML += `<p class="success">âœ… æ–‡ä»¶å¯è®¿é—® (çŠ¶æ€ç : ${headResponse.status})</p>`;
                    
                    // æµ‹è¯•2: æ£€æŸ¥æ–‡ä»¶å¤§å°
                    const contentLength = headResponse.headers.get('content-length');
                    resultDiv.innerHTML += `<p>ğŸ“¦ æœåŠ¡å™¨æŠ¥å‘Šæ–‡ä»¶å¤§å°: ${contentLength} å­—èŠ‚</p>`;
                    
                    // æµ‹è¯•3: æ£€æŸ¥Content-Type
                    const contentType = headResponse.headers.get('content-type');
                    resultDiv.innerHTML += `<p>ğŸ“„ Content-Type: ${contentType}</p>`;
                    
                    // æµ‹è¯•4: å®é™…ä¸‹è½½å¹¶æ£€æŸ¥
                    resultDiv.innerHTML += `<p>2. æµ‹è¯•å®é™…ä¸‹è½½...</p>`;
                    const downloadResponse = await fetch(fileUrl);
                    const blob = await downloadResponse.blob();
                    
                    resultDiv.innerHTML += `<p class="success">âœ… ä¸‹è½½æˆåŠŸ</p>`;
                    resultDiv.innerHTML += `<p>ğŸ“Š å®é™…ä¸‹è½½å¤§å°: ${blob.size} å­—èŠ‚</p>`;
                    
                    // æ£€æŸ¥å¤§å°æ˜¯å¦åŒ¹é…
                    if (contentLength && parseInt(contentLength) !== blob.size) {
                        resultDiv.innerHTML += `<p class="error">âŒ æ–‡ä»¶å¤§å°ä¸åŒ¹é…! å¯èƒ½è¢«ä¿®æ”¹</p>`;
                    } else {
                        resultDiv.innerHTML += `<p class="success">âœ… æ–‡ä»¶å¤§å°ä¸€è‡´</p>`;
                    }
                    
                    // æµ‹è¯•5: æ£€æŸ¥æ–‡ä»¶ç±»å‹
                    const firstBytes = await blob.slice(0, 4).arrayBuffer();
                    const header = new Uint8Array(firstBytes);
                    const headerHex = Array.from(header).map(b => b.toString(16).padStart(2, '0')).join(' ');
                    
                    resultDiv.innerHTML += `<p>ğŸ” æ–‡ä»¶å¤´ç­¾å: ${headerHex}</p>`;
                    
                    // ZIPæ–‡ä»¶åº”è¯¥ä»¥ PK å¼€å¤´ (50 4B)
                    if (header[0] === 0x50 && header[1] === 0x4B) {
                        resultDiv.innerHTML += `<p class="success">âœ… æœ‰æ•ˆçš„ZIPæ–‡ä»¶ç­¾å (PK)</p>`;
                    } else {
                        resultDiv.innerHTML += `<p class="error">âŒ æ— æ•ˆçš„æ–‡ä»¶ç­¾å! æ–‡ä»¶å¯èƒ½æŸåæˆ–è¢«ç¯¡æ”¹</p>`;
                        resultDiv.innerHTML += `<p>æœŸæœ›: 50 4B (PK ZIPç­¾å)ï¼Œå®é™…: ${headerHex}</p>`;
                    }
                    
                } catch (error) {
                    resultDiv.innerHTML += `<p class="error">âŒ æµ‹è¯•å¤±è´¥: ${error.message}</p>`;
                }
                
                resultDiv.innerHTML += '<hr>';
            }
        }
        
        // é¡µé¢åŠ è½½åè‡ªåŠ¨è¿è¡Œè¯Šæ–­
        diagnoseDownload();
    </script>
</body>
</html>